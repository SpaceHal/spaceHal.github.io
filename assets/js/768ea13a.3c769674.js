"use strict";(self.webpackChunkspace_hal_2=self.webpackChunkspace_hal_2||[]).push([[6921],{22987:function(e,n,r){r.r(n),r.d(n,{contentTitle:function(){return y},default:function(){return D},frontMatter:function(){return E},metadata:function(){return S},toc:function(){return A}});var t=r(87462),a=r(63366),i=r(67294),s=r(3905),d=r(67478),l=r(66693),o=r(89630),m=r(24846),c=r(33466),p=r(11949),u=r(96486),g=["#252525","#525252","#737373","#969696","#bdbdbd","#d9d9d9","#f0f0f0"],h="#252525",k="#969696",b={width:600,height:300,padding:50,colorScale:g},w={fontFamily:"'Gill Sans', 'Seravek', 'Trebuchet MS', sans-serif",fontSize:14,letterSpacing:"normal",padding:10,fill:h,stroke:"transparent"},f=(0,u.assign)({textAnchor:"middle"},w),N="round",v="round",z={area:(0,u.assign)({style:{data:{fill:h},labels:w}},b),axis:(0,u.assign)({style:{axis:{fill:"transparent",stroke:h,strokeWidth:1,strokeLinecap:N,strokeLinejoin:v},axisLabel:(0,u.assign)({},f,{padding:25}),grid:{fill:"none",stroke:"Gainsboro",strokeLinecap:N,strokeLinejoin:v,pointerEvents:"painted"},ticks:{fill:"transparent",size:1,stroke:"transparent"},tickLabels:w}},b),bar:(0,u.assign)({style:{data:{fill:h,padding:8,strokeWidth:0},labels:w}},b),boxplot:(0,u.assign)({style:{max:{padding:8,stroke:h,strokeWidth:1},maxLabels:(0,u.assign)({},w,{padding:3}),median:{padding:8,stroke:h,strokeWidth:1},medianLabels:(0,u.assign)({},w,{padding:3}),min:{padding:8,stroke:h,strokeWidth:1},minLabels:(0,u.assign)({},w,{padding:3}),q1:{padding:8,fill:k},q1Labels:(0,u.assign)({},w,{padding:3}),q3:{padding:8,fill:k},q3Labels:(0,u.assign)({},w,{padding:3})},boxWidth:20},b),candlestick:(0,u.assign)({style:{data:{stroke:h,strokeWidth:1},labels:(0,u.assign)({},w,{padding:5})},candleColors:{positive:"#ffffff",negative:h}},b),chart:b,errorbar:(0,u.assign)({borderWidth:8,style:{data:{fill:"transparent",stroke:h,strokeWidth:2},labels:w}},b),group:(0,u.assign)({colorScale:g},b),histogram:(0,u.assign)({style:{data:{fill:k,stroke:h,strokeWidth:2},labels:w}},b),legend:{colorScale:g,gutter:10,orientation:"vertical",titleOrientation:"top",style:{data:{type:"circle"},labels:w,title:(0,u.assign)({},w,{padding:5})}},line:(0,u.assign)({style:{data:{fill:"transparent",stroke:h,strokeWidth:2},labels:w}},b),pie:{style:{data:{padding:10,stroke:"transparent",strokeWidth:1},labels:(0,u.assign)({},w,{padding:20})},colorScale:g,width:400,height:400,padding:50},scatter:(0,u.assign)({style:{data:{fill:h,stroke:"transparent",strokeWidth:0},labels:w}},b),stack:(0,u.assign)({colorScale:g},b),tooltip:{style:(0,u.assign)({},w,{padding:0,pointerEvents:"none"}),flyoutStyle:{stroke:h,strokeWidth:1,fill:"#f0f0f0",pointerEvents:"none"},flyoutPadding:5,cornerRadius:5,pointerLength:10},voronoi:(0,u.assign)({style:{data:{fill:"transparent",stroke:"transparent",strokeWidth:0},labels:(0,u.assign)({},w,{padding:5,pointerEvents:"none"}),flyout:{stroke:h,strokeWidth:1,fill:"#f0f0f0",pointerEvents:"none"}}},b)},x=[{x:10076,speed:0,error:2e3,integral:2e3,power:200},{x:20108,speed:399,error:1601,integral:3601,power:360},{x:30108,speed:1200,error:800,integral:4e3,power:400},{x:40112,speed:1699,error:301,integral:4e3,power:400},{x:50108,speed:2150,error:-150,integral:3850,power:385},{x:60124,speed:2349,error:-349,integral:3501,power:350},{x:70116,speed:2700,error:-700,integral:2801,power:280},{x:80124,speed:2650,error:-650,integral:2151,power:215},{x:90128,speed:2598,error:-598,integral:1553,power:155},{x:100120,speed:2500,error:-500,integral:1053,power:105},{x:110124,speed:2200,error:-200,integral:853,power:85},{x:120132,speed:1999,error:1,integral:854,power:85},{x:130120,speed:1800,error:200,integral:1054,power:105},{x:140136,speed:1599,error:401,integral:1455,power:145},{x:150136,speed:1648,error:352,integral:1807,power:180},{x:160160,speed:1697,error:303,integral:2110,power:211},{x:170148,speed:1849,error:151,integral:2261,power:226},{x:180160,speed:1798,error:202,integral:2463,power:246},{x:190180,speed:1998,error:2,integral:2465,power:246},{x:200188,speed:2146,error:-146,integral:2319,power:231},{x:210196,speed:2248,error:-248,integral:2071,power:207},{x:220200,speed:2299,error:-299,integral:1772,power:177},{x:230220,speed:2297,error:-297,integral:1475,power:147},{x:240228,speed:2148,error:-148,integral:1327,power:132},{x:250236,speed:2048,error:-48,integral:1279,power:127},{x:260228,speed:1899,error:101,integral:1380,power:138},{x:270248,speed:1896,error:104,integral:1484,power:148},{x:280256,speed:1798,error:202,integral:1686,power:168},{x:290256,speed:1900,error:100,integral:1786,power:178},{x:300272,speed:1896,error:104,integral:1890,power:189},{x:310280,speed:1847,error:153,integral:2043,power:204},{x:320288,speed:1897,error:103,integral:2146,power:214},{x:330300,speed:2099,error:-99,integral:2047,power:204},{x:340296,speed:2149,error:-149,integral:1898,power:189},{x:350324,speed:2097,error:-97,integral:1801,power:180},{x:360332,speed:2098,error:-98,integral:1703,power:170},{x:370328,speed:2149,error:-149,integral:1554,power:155},{x:380328,speed:2099,error:-99,integral:1455,power:145},{x:390336,speed:1949,error:51,integral:1506,power:150},{x:400340,speed:1899,error:101,integral:1607,power:160},{x:410336,speed:1949,error:51,integral:1658,power:165},{x:420344,speed:1899,error:101,integral:1759,power:175},{x:430344,speed:1899,error:101,integral:1860,power:186},{x:440356,speed:1948,error:52,integral:1912,power:191},{x:450352,speed:1900,error:100,integral:2012,power:201},{x:460368,speed:2047,error:-47,integral:1965,power:196},{x:470376,speed:2097,error:-97,integral:1868,power:186},{x:480384,speed:2050,error:-50,integral:1818,power:181},{x:490384,speed:2099,error:-99,integral:1719,power:171}];var R=function(){return i.createElement("div",{style:{maxWidth:"650px",margin:"auto",border:"0px solid rgb(100, 100, 100)"}},i.createElement(d.Z,{style:{grid:{stroke:"#ddd444",strokeWidth:1.5}},containerComponent:i.createElement(l.Z,{cursorDimension:"y",cursorLabel:function(e){var n=e.datum;return""+Math.floor(n.y)},cursorLabelComponent:i.createElement(o.Z,{style:{fill:"Grey",fontStyle:"italic"},backgroundStyle:{fill:"White"},backgroundPadding:3}),cursorComponent:i.createElement(m.Z,null)}),width:600,height:300,theme:z,domainPadding:{x:[0,0],y:5},padding:{left:80,right:50,top:50,bottom:50}},i.createElement(o.Z,{x:20,y:10,style:{fontSize:"16px",fontWeight:"normal"},text:"I-Regler f\xfcr die Geschwindigkeit"}),i.createElement(o.Z,{x:550,y:10,text:"Motor Speed",style:{fontStyle:"italic",textAnchor:"end"}}),i.createElement(o.Z,{x:550,y:30,text:"Integral-Anteil",style:{fill:"#c43a31",fontStyle:"italic",textAnchor:"end"}}),i.createElement(o.Z,{x:20,y:130,angle:-90,text:"Encoder-Impulse pro Sekunde",style:{fontStyle:"italic",textAnchor:"middle"}}),i.createElement(o.Z,{x:320,y:290,angle:0,text:"Zeit",style:{fontStyle:"italic",textAnchor:"middle"}}),i.createElement(c.Z,{tickFormat:function(e){return Math.round(e)/1e3+" ms"}}),i.createElement(c.Z,{dependentAxis:!0,tickFormat:function(e){return""+Math.round(e)}}),i.createElement(p.Z,{animate:{duration:2e3,onLoad:{duration:2e3}},interpolation:"natural",data:x,x:"x",y:"speed"}),i.createElement(p.Z,{animate:{duration:2e3,onLoad:{duration:2e3}},interpolation:"natural",style:{data:{stroke:"#c43a31"}},data:x,x:"x",y:"error"})),i.createElement("div",{style:{margin:"auto"}},i.createElement("button",{className:"btnchart"},"  ki = 0.1  "),i.createElement("button",{className:"btnchart"},"  ki = 0.2  "),i.createElement("button",{className:"btnchart"},"  ki = 0.4  "),i.createElement("button",{className:"btnchart"},"  ki = 0.1, kp=1  "),i.createElement("button",{className:"btnchart"},"  ki = 0.2, kp =1  ")))},E={id:"wheelEncoder",title:"Die zur\xfcckegelegte Strecke der R\xe4der mit dem Rad-Encoder messen.",sidebar_label:"Rad-Encoder",description:"Den Roboter mit dem Rad-Encoder geradeaus fahren lassen und die Geschwindikeit regeln.",custom_edit_url:null,keywords:["Arduino","Roboter","Robotik","Odometrie","Quadraturencoder","Inkrementalgeber","Positionsbestimmung","Zumo32u4","Zumo"]},y=void 0,S={unversionedId:"robotik/wheelEncoder",id:"robotik/wheelEncoder",isDocsHomePage:!1,title:"Die zur\xfcckegelegte Strecke der R\xe4der mit dem Rad-Encoder messen.",description:"Den Roboter mit dem Rad-Encoder geradeaus fahren lassen und die Geschwindikeit regeln.",source:"@site/docs/robotik/wheelEncoder.mdx",sourceDirName:"robotik",slug:"/robotik/wheelEncoder",permalink:"/docs/robotik/wheelEncoder",editUrl:null,tags:[],version:"current",frontMatter:{id:"wheelEncoder",title:"Die zur\xfcckegelegte Strecke der R\xe4der mit dem Rad-Encoder messen.",sidebar_label:"Rad-Encoder",description:"Den Roboter mit dem Rad-Encoder geradeaus fahren lassen und die Geschwindikeit regeln.",custom_edit_url:null,keywords:["Arduino","Roboter","Robotik","Odometrie","Quadraturencoder","Inkrementalgeber","Positionsbestimmung","Zumo32u4","Zumo"]},sidebar:"sideBarRobotik",previous:{title:"Linie mit Kreuzungen",permalink:"/docs/robotik/advancedLine"},next:{title:"Odometrie",permalink:"/docs/robotik/odometrie"}},A=[{value:"Inkrementalgeber (<em>Incremental Encoder</em>)",id:"inkrementalgeber-incremental-encoder",children:[{value:"Quadratur-Encoder (<em>Quadrature Encoder</em>)",id:"quadratur-encoder-quadrature-encoder",children:[]}]},{value:"Auslesen der Rad-Encoder beim Zumo 32u4",id:"auslesen-der-rad-encoder-beim-zumo-32u4",children:[{value:"Aufgaben",id:"aufgaben",children:[]}]},{value:"Geradeausfahren mit einem P-Regler",id:"geradeausfahren-mit-einem-p-regler",children:[{value:"Systematische Odometry-Fehler",id:"systematische-odometry-fehler",children:[]},{value:"Nicht-Systematische Odometry-Fehler",id:"nicht-systematische-odometry-fehler",children:[]},{value:"Kalibrierung des Geradeauslaufs",id:"kalibrierung-des-geradeauslaufs",children:[]},{value:"Aufgaben",id:"aufgaben-1",children:[]}]},{value:"Ein Integral-Regler f\xfcr die Geschwindigkeit",id:"ein-integral-regler-f\xfcr-die-geschwindigkeit",children:[]}],M={toc:A};function D(e){var n=e.components,r=(0,a.Z)(e,["components"]);return(0,s.kt)("wrapper",(0,t.Z)({},M,r,{components:n,mdxType:"MDXLayout"}),(0,s.kt)("h2",{id:"inkrementalgeber-incremental-encoder"},"Inkrementalgeber (",(0,s.kt)("em",{parentName:"h2"},"Incremental Encoder"),")"),(0,s.kt)("p",null,"Eine der ersten Aufgaben f\xfcr den selbstgebauten Roboter war es, den Roboter eine Strecke von 1,5 Meter fahren zu lassen. Die L\xf6sung konnte nur durch Probieren von unterschiedliche langen Fahrzeit ermittelt werden. Was dem selbstgebauten Roboter fehlte, war die M\xf6glichkeit den zur\xfcckgelegten Fahrtweg zu messen."),(0,s.kt)("p",null,"Die ",(0,s.kt)("strong",{parentName:"p"},"Odometrie")," ist eine Methode, wie mit Hilfe der beiden Antriebsr\xe4der nicht nur der zur\xfcckgelegte Weg, sondern ganz allgemein die Position und Orientierung eines mobilien Roboters bestimmt werden kann. Hierf\xfcr wir mit einem ",(0,s.kt)("a",{parentName:"p",href:"https://de.wikipedia.org/wiki/Inkrementalgeber"},"Inkrementalgeber")," (Radencoder) an jedem Motor bestimmt, wie weit sich die einzelnen Motoren zwischen zwei Messungen gedreht haben. "),(0,s.kt)("p",null,"Der Zumo 32u4 hat an jedem Motor einen ",(0,s.kt)("a",{parentName:"p",href:"#quadratur-encoder-quadrature-encdoder"},"Quadratur-Encoder"),", welcher mit einer magnetischen Scheibe pro Motorwelle und zwei ",(0,s.kt)("a",{parentName:"p",href:"https://www.leifiphysik.de/elektrizitaetslehre/bewegte-ladungen-feldern/grundwissen/hall-effekt"},"Hall-Effekt"),"-Sensoren f\xfcr jeden Motor realisiert ist. Der Quadratur-Encoder hat eine Aufl\xf6sung von 12 Schritten pro Umdrehung."),(0,s.kt)("p",null,"Da die R\xe4der nicht direkt, sondern mit einem Getriebe  mit der Motorwelle verbunden sind (\xdcbersetzung 75.81:1), f\xfchrt das zu einer Aufl\xf6sung von ",(0,s.kt)("span",{parentName:"p",className:"math math-inline"},(0,s.kt)("span",{parentName:"span",className:"katex"},(0,s.kt)("span",{parentName:"span",className:"katex-mathml"},(0,s.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.kt)("semantics",{parentName:"math"},(0,s.kt)("mrow",{parentName:"semantics"},(0,s.kt)("mn",{parentName:"mrow"},"12"),(0,s.kt)("mo",{parentName:"mrow"},"\xd7"),(0,s.kt)("mn",{parentName:"mrow"},"75.81"),(0,s.kt)("mo",{parentName:"mrow"},"\u2248"),(0,s.kt)("mn",{parentName:"mrow"},"909"),(0,s.kt)("mo",{parentName:"mrow",separator:"true"},","),(0,s.kt)("mn",{parentName:"mrow"},"7")),(0,s.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"12\\times 75.81 \\approx 909,7")))),(0,s.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.72777em",verticalAlign:"-0.08333em"}}),(0,s.kt)("span",{parentName:"span",className:"mord"},"1"),(0,s.kt)("span",{parentName:"span",className:"mord"},"2"),(0,s.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222222222222222em"}}),(0,s.kt)("span",{parentName:"span",className:"mbin"},"\xd7"),(0,s.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222222222222222em"}})),(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.64444em",verticalAlign:"0em"}}),(0,s.kt)("span",{parentName:"span",className:"mord"},"7"),(0,s.kt)("span",{parentName:"span",className:"mord"},"5"),(0,s.kt)("span",{parentName:"span",className:"mord"},"."),(0,s.kt)("span",{parentName:"span",className:"mord"},"8"),(0,s.kt)("span",{parentName:"span",className:"mord"},"1"),(0,s.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}}),(0,s.kt)("span",{parentName:"span",className:"mrel"},"\u2248"),(0,s.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}})),(0,s.kt)("span",{parentName:"span",className:"base"},(0,s.kt)("span",{parentName:"span",className:"strut",style:{height:"0.8388800000000001em",verticalAlign:"-0.19444em"}}),(0,s.kt)("span",{parentName:"span",className:"mord"},"9"),(0,s.kt)("span",{parentName:"span",className:"mord"},"0"),(0,s.kt)("span",{parentName:"span",className:"mord"},"9"),(0,s.kt)("span",{parentName:"span",className:"mpunct"},","),(0,s.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.16666666666666666em"}}),(0,s.kt)("span",{parentName:"span",className:"mord"},"7")))))," Impulsen pro Umdrehung (CPR - counts per revolution)."),(0,s.kt)("img",{src:"/img/robotik/RadEncoder.png",alt:"Ein Radencoder f\xfcr die Odometrie",width:"450px",class:"center"}),(0,s.kt)("h3",{id:"quadratur-encoder-quadrature-encoder"},"Quadratur-Encoder (",(0,s.kt)("em",{parentName:"h3"},"Quadrature Encoder"),")"),(0,s.kt)("p",null,"Der oben dargestellte Rad-Encoder ist ein sehr einfacher Inkrementalgeber. Was diesem Encoder jedoch fehlt, ist die M\xf6glichkeit die Drehrichtung des Rades zu bestimmen. Ein Quadratur-Encoder schafft hier Abhilfe. "),(0,s.kt)("p",null,"Bei einem Quadratur-Encoder wird das Rad nicht mit einem Sensor, sondern mit ",(0,s.kt)("strong",{parentName:"p"},"zwei r\xe4umlich versetzten Sensoren")," abgetastet. Dadurch ergibt sich nicht nur eine Impulsfolge, welche angibt, wie weit sich das Rad gedreht hat, sondern ",(0,s.kt)("strong",{parentName:"p"},"zwei Impulsfolgen (A und B)")," aus welchen zus\xe4tzlich auch die Drehrichtung bestimmt werden kann. "),(0,s.kt)("h4",{id:"drehrichtung-im-uhrzeigersinn"},"Drehrichtung im Uhrzeigersinn"),(0,s.kt)("p",null,"In der dargestellten Abbilung sind die beiden Encoder-Sensoren mit den Buchstaben A und B bezeichnet. Der rechte Sensor (A) ist bei einer Drehung im ",(0,s.kt)("strong",{parentName:"p"},"Uhrzeigersinn")," der Sensor, welcher zuerst die Zustands\xe4nderungen (von 0 auf 1 oder andersrum) detektiert. Der Sensor B wird die selbe Zustands\xe4nderung kurz danach detektieren. Das bedeutet, dass direkt nach dem Zustandswechsel des Sensors A, der Sensor B noch im alten Zustand ist. "),(0,s.kt)("p",null,"Bei einer ",(0,s.kt)("strong",{parentName:"p"},"Drehung im Uhrzeigersinn")," gilt bei der Zustands\xe4nderung des Sensors A: ",(0,s.kt)("inlineCode",{parentName:"p"},"B=!A"),"."),(0,s.kt)("img",{src:"/img/robotik/QuadEncoderClockwise.png",alt:"Quadratur Encoder",width:"530px",class:"center"}),(0,s.kt)("h4",{id:"drehrichtung-entgegen-dem-uhrzeigersinn"},"Drehrichtung entgegen dem Uhrzeigersinn"),(0,s.kt)("p",null,"Dreht sich das Rad entgegen dem Uhrzeigersinn ist der Sensor B der f\xfchrende Sensor und erkennt die Zustands\xe4nderung als erstes. Aus Sicht des Sensors A bedeutet das, dass der Sensor A bei einer Zustands\xe4nderung den bereits detektierten Zustand vom Sensor A annimmt."),(0,s.kt)("p",null,"Bei einer ",(0,s.kt)("strong",{parentName:"p"},"Drehung entgegen dem Uhrzeigersinn")," gilt bei der Zustands\xe4nderung des Sensors A: ",(0,s.kt)("inlineCode",{parentName:"p"},"B=A"),"."),(0,s.kt)("img",{src:"/img/robotik/QuadEncoderCC.png",alt:"Quadratur Encoder",width:"530px",class:"center"}),(0,s.kt)("h2",{id:"auslesen-der-rad-encoder-beim-zumo-32u4"},"Auslesen der Rad-Encoder beim Zumo 32u4"),(0,s.kt)("p",null,"In der Zumo32u4-Bibliothek wird die Klasse ",(0,s.kt)("inlineCode",{parentName:"p"},"Zumo32U4Encoders")," bereitgestellt, welche es mit den Methode ",(0,s.kt)("inlineCode",{parentName:"p"},"getCountsLeft()")," und ",(0,s.kt)("inlineCode",{parentName:"p"},"getCountsRight()")," erm\xf6glicht, die vom Encoder gemessenen Impulse auszugeben. "),(0,s.kt)("p",null,"Die Methoden zum Auslesen der Rad-Encoder verwenden im Hintergrund so genannte ",(0,s.kt)("a",{parentName:"p",href:"https://de.wikipedia.org/wiki/Interrupt"},"Interrupt-Funktionen"),", welches jedesmal, wenn die Encoder einen Impuls erhalten, eine globale Variable im eins erh\xf6hen oder verringern (abh\xe4ngig von der Drehrichtung). Die Methoden ",(0,s.kt)("inlineCode",{parentName:"p"},"getCountsLeft()")," und ",(0,s.kt)("inlineCode",{parentName:"p"},"getCountsRight()")," geben dann die aktuelle Anzahl der aufsummierten Impulse pro Rad an."),(0,s.kt)("p",null,"Die Methoden ",(0,s.kt)("inlineCode",{parentName:"p"},"getCountsAndResetLeft()")," und ",(0,s.kt)("inlineCode",{parentName:"p"},"getCountsAndResetRight()")," verhalten sich wie die anderen beiden Funktionen, setzten jedoch die entsprechende globale Variable f\xfcr die aufsummierten Impulse zur\xfcck."),(0,s.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,s.kt)("div",{parentName:"div",className:"admonition-heading"},(0,s.kt)("h5",{parentName:"div"},(0,s.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,s.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,s.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,s.kt)("div",{parentName:"div",className:"admonition-content"},(0,s.kt)("p",{parentName:"div"},"Damit die globalen Z\xe4hler f\xfcr die Encoder-Impulse nicht \xfcberlaufen, sollten regelm\xe4\xdfig die Funktionen ",(0,s.kt)("inlineCode",{parentName:"p"},"getCountsAndResetLeft()")," und ",(0,s.kt)("inlineCode",{parentName:"p"},"getCountsAndResetRight()")," aufgerufen werden."))),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-arduino"},"// Anzeigen der Encoder-Werte auf dem Display \n\n#include <Wire.h>\n#include <Zumo32U4.h>\n\nZumo32U4Encoders encoders;                       //  Encoder-Objekt deklarieren\nZumo32U4LCD lcd;\n\nunsigned long lastDisplayTime = 0;\n\nvoid setup() {\n                                                // bleibt leer\n}\n\nvoid loop() {\n  if ((millis() - lastDisplayTime) > 100) {\n\n    int countsLeft = encoders.getCountsLeft();   // Auslesen des globalen Impuls-Z\xe4hlers\n    int countsRight = encoders.getCountsRight(); // Die Impulse werden im Hintergrund gez\xe4hlt\n\n    lcd.clear();\n    lcd.print(countsLeft);\n    lcd.gotoXY(0, 1);\n    lcd.print(countsRight);\n    \n    lastDisplayTime = millis();\n  }\n}\n")),(0,s.kt)("h3",{id:"aufgaben"},"Aufgaben"),(0,s.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,s.kt)("div",{parentName:"div",className:"admonition-heading"},(0,s.kt)("h5",{parentName:"div"},(0,s.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,s.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,s.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"\xdcBEN")),(0,s.kt)("div",{parentName:"div",className:"admonition-content"},(0,s.kt)("ol",{parentName:"div"},(0,s.kt)("li",{parentName:"ol"},"Die Radencoder haben eine Aufl\xf6sung von 909,7 Impulsen pro Rad-Umdrehung. Bestimmen Sie rechnerisch, wie weit der zur\xfcckgelegte Weg zwischen zwei Encoder-Impulse ist (Millimeter pro Impuls).\n",(0,s.kt)("em",{parentName:"li"},"Hinweis: Messen Sie den Durchmesser der R\xe4der.")),(0,s.kt)("li",{parentName:"ol"},"Messen Sie die Anzahl der Encoder-Impulse die ben\xf6tigt werden, um eine Strecke von exakt 20 cm zur\xfcckzulegen. Bestimmen Sie hieraus die Encoder-Aufl\xf6sung (in zur\xfcckgelegten Millimeter pro gefahrenem Meter)."),(0,s.kt)("li",{parentName:"ol"},"Schreiben Sie ein Programm, welches den Roboter mit Hilfe der Rad-Encoder ",(0,s.kt)("strong",{parentName:"li"},"exakt")," 20 cm weit fahren l\xe4sst. Vergleichen Sie Ihr Ergebnis mit der Aufgabe 2. (Die zur\xfcckgelegt Strecke sollte als Mittelwert aus den beiden Rad-Encoder berechnet werden.)"),(0,s.kt)("li",{parentName:"ol"},"Wiederholden Sie die letzte Aufgabe. Versuchen Sie jedoch den Roboter die 20 cm so schnell wie m\xf6glich zur\xfccklegen zu lassen. Messen Sie die Zeit. (",(0,s.kt)("em",{parentName:"li"},"Hinweis: Nutzen Sie einen geeigneten Regler"),")")))),(0,s.kt)("h2",{id:"geradeausfahren-mit-einem-p-regler"},"Geradeausfahren mit einem P-Regler"),(0,s.kt)("p",null,"Mit den Rad-Encodern kann der Roboter nicht nur messen, wie weit sich jedes einzelne Rad gedreht hat, sondern es ist auch m\xf6glich den Roboter damit geradeaus fahren zu lassen. Hierf\xfcr reicht es aus, dass sich beide R\xe4der immer gleich schnell drehen. Ein einfacher Ansatz w\xe4re daf\xfcr ein P-Regler, welcher versucht die Differenz zwischen den Encoder-Impulsen auf null zu reduzieren."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-go"},"error = impulseEncoderLinks - impulseEncoderRechts // Regelabweichung\n")),(0,s.kt)("p",null,"Allerdings ist es sehr wahrscheinlich, dass der Roboter, obwohl sich beide R\xe4der gleich schnell drehen, nicht ganz gerade f\xe4hrt. Ursache hierf\xfcr sind  ",(0,s.kt)("strong",{parentName:"p"},"systematische und nicht-systematische Fehler"),"."),(0,s.kt)("img",{src:"/img/robotik/FehlerGeradeaus.png",alt:"Fehler Geradeauslauf",width:"550px",class:"center"}),(0,s.kt)("h3",{id:"systematische-odometry-fehler"},"Systematische Odometry-Fehler"),(0,s.kt)("p",null,"Systematische Fehler werden durch physikalische Abweichung des realen Roboters von dem theoretischem Bewegungs-Modell verursacht. Ein Beispiel sind unterschiedliche Durchmesser der beiden R\xe4der oder auch R\xe4der, welche nicht genau parallel zueinander ausgerichtet sind. Systematische Fehler sind \xfcber einen l\xe4ngeren Zeitraum konstant und k\xf6nnen daher bis zu einem gewissen Grad kompensiert werden."),(0,s.kt)("p",null,"Auf ebenen Untergr\xfcnden dominieren die systematische Odometry-Fehler."),(0,s.kt)("h3",{id:"nicht-systematische-odometry-fehler"},"Nicht-Systematische Odometry-Fehler"),(0,s.kt)("p",null,"Im Gegensatz dazu ist das Auftreten von nicht-systematisch Fehler nicht exakt vorherzubestimmen. Nicht-systematische Fehler werden zum Beispiel durch Bodenunebenheiten oder auch durch unpr\xe4zise gefertigte Achsen der R\xe4der, welche ein zu gro\xdfes Spiel aufweisen, verursacht. "),(0,s.kt)("h3",{id:"kalibrierung-des-geradeauslaufs"},"Kalibrierung des Geradeauslaufs"),(0,s.kt)("p",null,"Der einfachste Ansatz den Geradeauslauf zu verbessern, ist die Verwendung eines ",(0,s.kt)("em",{parentName:"p"},"Faktors")," welcher zum Beispiel Unterschiede in den Raddurchmessern ber\xfccksichtigt. Dabei wird zum Berechnen des ",(0,s.kt)("strong",{parentName:"p"},"Fehler")," f\xfcr den Regler einer der beiden Rad-Encoder mit einem Faktor (",(0,s.kt)("inlineCode",{parentName:"p"},"geradeFaktor"),") multipliziert. Der richtige Faktor zum m\xf6glichst geraden Fahren muss experimentell bestimmt werden."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-go"},"geradeFaktor = 0.95 // Werte zwischen 0.9 und 1.1\nerror = impulseEncoderLinks - geradeFaktor*impulseEncoderRechts // \n")),(0,s.kt)("p",null,"Ein deutlich komplexerer Ansatz zur Kompensation verschiedener systematischer Fehler wird von ",(0,s.kt)("a",{parentName:"p",href:"http://www-personal.umich.edu/~johannb/Papers/paper58.pdf"},"Borenstein und Feng")," beschrieben."),(0,s.kt)("h3",{id:"aufgaben-1"},"Aufgaben"),(0,s.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,s.kt)("div",{parentName:"div",className:"admonition-heading"},(0,s.kt)("h5",{parentName:"div"},(0,s.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,s.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,s.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),(0,s.kt)("strong",{parentName:"h5"},"\xdcben"))),(0,s.kt)("div",{parentName:"div",className:"admonition-content"},(0,s.kt)("ol",{parentName:"div"},(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"Lassen Sie den Roboter eine Strecke von ca. 1 Meter mit gleichen Motorgeschwindigkeiten f\xfcr beide Seiten (z.B. ",(0,s.kt)("inlineCode",{parentName:"p"},"setSpeeds(200,200)"),") fahren. Geben Sie den Unterschied der Encoder-Impulse zwischen den R\xe4dern auf dem Display aus.  Bestimmen Sie auch die mittlere Differenz zwischen den Encodern in Millimetern pro gefahrenen Meter.")),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"Schreiben Sie eine Funktion ",(0,s.kt)("inlineCode",{parentName:"p"},"void fahreGerade()")," welche den Roboter mit Hilfe der Rad-Encoder und eines P-Reglers geradeaus fahren l\xe4sst. ")),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"Optimieren Sie den P-Regler zum Geradeausfahren mit einem Kalibrierungsfaktor, welcher m\xf6gliche Abweichungen vom Geradeausfahren korrigiert.")),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"Lassen Sie den Roboter \xfcber eine Zeit von ca. 0,4 Sekunden mit verschiedenen Geschwindigkeiten (200, 300, 400) fahren. Bestimmen sie gleichzeitig die ",(0,s.kt)("strong",{parentName:"p"},"aktuelle Geschwindigkeit in Impulsen pro Sekunde"),". Nutzen Sie f\xfcr die Zeitmessung f\xfcr eine bessere Genauigkeit die ",(0,s.kt)("a",{parentName:"p",href:"https://www.arduino.cc/reference/de/language/functions/time/micros/"},(0,s.kt)("inlineCode",{parentName:"a"},"micros()"))," Funktion. Geben Sie die Geschwindigkeiten w\xe4hrend des Beschleunigungsvorgangs auf dem seriellen Monitor aus."),(0,s.kt)("p",{parentName:"li"},"Stellen Sie abschlie\xdfend ihr Ergebnisse mit einem geeignetem Programm (z.B. ",(0,s.kt)("a",{parentName:"p",href:"https://support.microsoft.com/de-de/topic/darstellen-von-daten-im-punkt-oder-liniendiagramm-4570a80f-599a-4d6b-a155-104a9018b86e#OfficeVersion=Windows"},"Excel")," oder Openoffice) graphisch dar (y-Achse: Impulse pro Sekunde, x-Achse: Zeit in Millisekudnen) und beantworten Sie folgende Fragen:"),(0,s.kt)("ol",{parentName:"li"},(0,s.kt)("li",{parentName:"ol"},"Wie lange ben\xf6tigt der Roboter, bis er seine jeweilige Maximalgeschwindigkeit erreicht hat?"),(0,s.kt)("li",{parentName:"ol"},"Welcher Funktionstyp beschreibt den Zusammenhang zwischen Zeit und Geschwindigkeit am besten.   ")))))),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"// ...   \n\n// Zum Bestimmen der Geschwindigkeit sollten in einem festen Zeitintervall `dTime` die\n// Encoder-Impulse der R\xe4der bestimmt werden. Damit die Ergebnisse nicht zu stark schwanken\n// (Quantisierungsfehler), sollte das Zeitintervall in welchem die Encoder-Impulse bestimmt\n// werden so festgelegt sein, das im Mittel ca. 50 Impulse detektiert werden.\n\nint dTime = 20 * 1e3;                                  // in Mikrosekunden\n\nmotors.setSpeeds(MOTOR_POWER, MOTOR_POWER);\nwhile (jetzt - startTime < ON_TIME) {                  // Messung dauert insgesamt ON_TIME\n  aktuelleZeit = micros();                             // Nutzen Sie micros() f\xfcr eine bessere Genauigkeit\n  \n  if (aktuelleZeit - letztesIntervall >= dTime) { \n    letztesIntervall = aktuelleZeit;\n    int ticksLeft = encoders.getCountsAndResetRight(); // Impulse auslesen und zur\xfccksetzen\n    int ticksRight = encoders.getCountsAndResetLeft();\n    \n    // ... \n  }  \n}\n// ... \n")),(0,s.kt)("h2",{id:"ein-integral-regler-f\xfcr-die-geschwindigkeit"},"Ein Integral-Regler f\xfcr die Geschwindigkeit"),(0,s.kt)("p",null,"Die Abbildung stellt den zeitlichen Verlauf des Integralanteils des Reglers und die resultierende Geschwindigkeit in Encoder-Impulsen pro Sekunde dar."),(0,s.kt)(R,{mdxType:"Mychart"}))}D.isMDXComponent=!0}}]);