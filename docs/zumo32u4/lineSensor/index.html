<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.69">
<link rel="search" type="application/opensearchdescription+xml" title="Rule The Bots" href="/opensearch.xml">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"><title data-react-helmet="true">Die Liniensensoren | Rule The Bots</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Die Liniensensoren | Rule The Bots"><meta data-react-helmet="true" name="description" content="Die Liniensensoren des Zumo32u4"><meta data-react-helmet="true" property="og:description" content="Die Liniensensoren des Zumo32u4"><meta data-react-helmet="true" property="og:url" content="https://spacehal.github.io//docs/zumo32u4/lineSensor"><link data-react-helmet="true" rel="shortcut icon" href="/img/LogoSmallRed.svg"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://spacehal.github.io//docs/zumo32u4/lineSensor"><link rel="stylesheet" href="/styles.89f3091e.css">
<link rel="preload" href="/styles.62cc0809.js" as="script">
<link rel="preload" href="/runtime~main.fe4ffd91.js" as="script">
<link rel="preload" href="/main.3a113c97.js" as="script">
<link rel="preload" href="/1.05c99323.js" as="script">
<link rel="preload" href="/63.da0c22a9.js" as="script">
<link rel="preload" href="/66.990c23fc.js" as="script">
<link rel="preload" href="/935f2afb.1d471f00.js" as="script">
<link rel="preload" href="/62.fbe59718.js" as="script">
<link rel="preload" href="/d943a4ea.0c352c0f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_2AhQ">Skip to main content</button></nav><nav class="navbar navbar--fixed-top navbarHideable_3046 navbarHidden_1Uo_"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/LogoSmallRed.svg" alt="Rule the Bots" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img src="/img/LogoSmallRed.svg" alt="Rule the Bots" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">RuleTheBots</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/arduino/helloworld">Arduino</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/robotik/beginning">Robotik</a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/zumo32u4/gettingStarted">Zumo32u4</a><a class="navbar__item navbar__link" href="/docs/more/links">Links</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">⌘</span><span class="DocSearch-Button-Key">K</span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/LogoSmallRed.svg" alt="Rule the Bots" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img src="/img/LogoSmallRed.svg" alt="Rule the Bots" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">RuleTheBots</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/arduino/helloworld">Arduino</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/robotik/beginning">Robotik</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/zumo32u4/gettingStarted">Zumo32u4</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/more/links">Links</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC sidebarWithHideableNavbar_2IoJ"><a tabindex="-1" class="sidebarLogo_Snse" href="/"><img src="/img/LogoSmallRed.svg" alt="Rule the Bots" class="themedImage_2E_h themedImage--light_AouX"><img src="/img/LogoSmallRed.svg" alt="Rule the Bots" class="themedImage_2E_h themedImage--dark_1YPN"><strong>RuleTheBots</strong></a><div class="menu menu--responsive thin-scrollbar menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Zumo32U4</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zumo32u4/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zumo32u4/gettingStarted">Getting Started</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Referenz</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zumo32u4/zumoBasics">LEDs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zumo32u4/buttons">Taster</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/zumo32u4/lineSensor">Liniensensoren</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zumo32u4/motors">Motoren</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zumo32u4/proxy">Näherungssensoren</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zumo32u4/encode">Rad-Encoder</a></li></ul></li></ul></li></ul></div><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_2Tub"></button></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_39qw"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Die Liniensensoren</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="einführung"></a>Einführung<a class="hash-link" href="#einführung" title="Direct link to heading">#</a></h2><p>Der Zumo32u4 hat fünf unabhängige IR-Bodensensoren, welche Linien oder auch Abgründe detektieren können. Die Sensoren befinden sich auf der Unterseite des Roboters, direkt hinter dem Metallschild. </p><img src="/img/zumo32u4/ZumoLineSensor.jpg" alt="Liniensensoren des Zumo" width="500px" class="center"><p> Ein einzelner <a href="https://www.pololu.com/docs/0J13/all#2" target="_blank" rel="noopener noreferrer">Bodensensor</a> bestehen aus einer Reihenschaltung eines <a href="https://www.pololu.com/file/0J117/QRE1113GR.pdf" target="_blank" rel="noopener noreferrer">Fototransistors</a> (welcher vereinfacht als lichtabhängiger Widerstand angesehen werden kann) und eines Kondensators. Ist der Kondensator aufgeladen, so hängt die Entladekurve vom Fototransistor und somit vom detektierten IR-Licht ab. Wird mit dem Mikrocontroller die Entladezeit des Kondensators gemessen, so kann damit die Menge des detektierten IR-Lichtes bestimmt werden.</p><p>Die Klasse <code>Zumo32U4LineSensors</code> stellt alle notwendigen Methoden zum Konfigurieren, Auslesen und Weiterverabeiten der 5 IR-Bodensensoren bereit. Sie ist in der Bibliothek des Zumo 32u4 integriert und wird durch den <code>include</code> Befehl in das Programm eingebunden.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-arduino codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">#inlcude &lt;Zumo32U4.h&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="konfigurieren"></a>Konfigurieren<a class="hash-link" href="#konfigurieren" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="void-initthreesensors"></a><code>void initThreeSensors()</code><a class="hash-link" href="#void-initthreesensors" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-arduino codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">void initThreeSensors(uint8_t emitterPin = SENSOR_LEDON)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Initialisiert und konfiguriert das Liniensensor-Objekt so, dass <strong>drei Sensoren</strong> (die beiden äußeren und der mittlere) verwendet werden. Kann verwendet werden, wenn auch alle drei Näherungssensoren genutzt werden.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="void-initfivesensors"></a><code>void initFiveSensors()</code><a class="hash-link" href="#void-initfivesensors" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-arduino codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">void initFiveSensors(uint8_t emitterPin = SENSOR_LEDON)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Initialisiert und konfiguriert das Liniensensor-Objekt so, dass <strong>alle fünf Sensoren</strong> verwendet werden. Funktioniert nur, wenn die seitlichen Näherungssensoren deaktiviert wurden. Korrekte Jumper-Einstellung an der Platine der Liniensensoren beachten.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="beispiel"></a>Beispiel<a class="hash-link" href="#beispiel" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-arduino codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">#inlcude &lt;Zumo32U4.h&gt;</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zumo32U4LineSensors lineSensors;    // Liniensensor-Objekt</span></div><div class="token-line" style="color:#393A34"><span class="token plain">void setup()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    lineSensors.initFiveSensors();  </span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="void-init"></a><code>void init(...)</code><a class="hash-link" href="#void-init" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-arduino codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">void init (uint8_t *pins, uint8_t numSensors, uint16_t timeout = 2000, uint8_t emitterPin = SENSOR_LEDON )</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Initialisiert das Liniensensor-Objekt so, dass es einen benutzerdefinierten Satz von <code>pins</code> verwendet. Meistens sollte die Konfiguration mit  <code>void initThreeSensors()</code> oder <code>void initFiveSensors()</code> ausreichen.</p><ul><li><p>Das Array <code>pins</code> enthält die Arduino-Pin-Nummer für jeden Sensor. </p></li><li><p><code>numSensors</code> gibt die Länge des Arrays <code>pins</code> an (d.h. die Anzahl der verwendeten Linien-Sensoren).</p></li><li><p><code>timeout</code> gibt die Zeitspanne in Mikrosekunden an, nach welcher der Sensor die Fläche als vollständig schwarz betrachtet. Das heißt, wenn die Impulslänge für einen Pin die Zeitüberschreitung überschreitet, wird das Impuls-Timing gestoppt und der Messwert für diesen Pin wird als volles Schwarz betrachtet. Es wird empfohlen, dass der Timeout zwischen 1000 und 3000 us eingestellt wird, abhängig vom Bodenabstand der Sensoren und der Umgebungsbeleuchtung. Die Verwendung von Timeout ermöglicht es, die Dauer eines Sensorlesezyklus zu verkürzen und gleichzeitig nützliche analoge Messungen des Reflexionsgrades beizubehalten.</p></li><li><p><code>emitterPin</code> ist der Arduino-Pin, der die IR-LEDs Liniensensoren steuert.</p></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="beispiel-1"></a>Beispiel<a class="hash-link" href="#beispiel-1" title="Direct link to heading">#</a></h4><p>Initialisieren der drei mittleren IR Sensoren.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-arduino codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">#inlcude &lt;Zumo32U4.h&gt;</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zumo32U4LineSensors lineSensors;                            // Liniensensor-Objekt</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">short pins[] = {SENSOR_DOWN2, SENSOR_DOWN3, SENSOR_DOWN4}; // Array mit Sensor-Pins</span></div><div class="token-line" style="color:#393A34"><span class="token plain">lineSensors.init(pins, sizeof(pins), 2000, SENSOR_LEDON);  // Initialisierung der Sensoren mit dem vorher definiertem Array </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="void-calibrate"></a><code>void calibrate()</code><a class="hash-link" href="#void-calibrate" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-arduino codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">void calibrate(unsigned char readMode = QTR_EMITTERS_ON)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Ließt die Sensorwerte für ein Kalibrierung. Die beim wiederholden aufrufen der Methode ermittelten Maximal- und Minimalwerte werden für jeden Sensor einzeln abgespeichert und bei der Methode <code>readCalibrated()</code> genutzt. Auf die Kalibrierungsdaten (Minimal- und Maximalwerte der Sensore) kann mit den Pointern <code>calibratedMinimumOn</code>, <code>calibratedMaximumOn</code> und <code>calibratedMinimumOff</code>, <code>calibratedMaximumOff</code> zugegriffen werden. Dieser Pointer zeigen auf Arrays mit der Länge <code>numSensors</code>, wie es bei die Initialisierung angegeben worden ist.</p><p>Die Kalibrierungsdaten werden von den Methoden <a href="#void-readcalibrated#"><code>readCalibrated()</code></a> und <a href="#int-readline"><code>readLine</code>()</a> verwendet.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="beispiel-2"></a>Beispiel<a class="hash-link" href="#beispiel-2" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-arduino codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">// Drehen des Roboters um +90°, -180° und abschließend +90° zum Kalibrieren der Liniensensoren</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">for(int i = 0; i &lt; 120; i++)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if (i &gt; 30 &amp;&amp; i &lt;= 90)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      motors.setSpeeds(-200, 200);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    else</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      motors.setSpeeds(200, -200);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    lineSensors.calibrate();  // Kalibrierungsmethode</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  motors.setSpeeds(0, 0);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="messen"></a>Messen<a class="hash-link" href="#messen" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="void-read"></a><code>void read(...)</code><a class="hash-link" href="#void-read" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-arduino codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">void read(unsigned int *sensor_values, unsigned char readMode=QTR_EMITTERS_ON)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Liest die rohen, unkalibrierten Sensorwerte in einen Array <code>sensor_values</code>. Es <strong>muss</strong> Platz für so viele Werte vorhanden sein, wie bei der Initialisierung an Sensoren angegeben wurden.
Die zurückgegebenen Werte sind ein Maß für den Reflexionsgrad in abstrakten Einheiten, wobei höhere Werte einem niedrigeren Reflexionsgrad entsprechen (z.B. eine schwarze Fläche oder ein Hohlraum). </p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="beispiel-3"></a>Beispiel<a class="hash-link" href="#beispiel-3" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-arduino codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">Zumo32U4LineSensors lineSensors;       // Liniensensor-Objekt</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">unsigned int lineSensorValues[3];      // Array für drei Sensorwerte</span></div><div class="token-line" style="color:#393A34"><span class="token plain">lineSensors.read(lineSensorValues);    // Array für die Sensorwerte wird überschrieben</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="void-readcalibrated"></a><code>void readCalibrated(...)</code><a class="hash-link" href="#void-readcalibrated" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-arduino codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">void readCalibrated(unsigned int *sensor_values, unsigned char readMode=QTR_EMITTERS_ON)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Liefert Werte, die auf einen Wert zwischen 0 und 1000 kalibriert sind, wobei 0 dem von <a href="#void-calibrate"><code>void calibrate()</code></a> gelesenen Minimalwert entspricht und 1000 dem Maximalwert entspricht.  Die Kalibrierungswerte werden für jeden Sensor separat gespeichert, so dass Unterschiede in den Sensoren automatisch berücksichtigt werden. Vor dem Aufruf der Methode sollte immer eine Kalibrierung mit <a href="#void-calibrate"><code>void calibrate()</code></a> durchgeführt werden.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="beispiel-4"></a>Beispiel<a class="hash-link" href="#beispiel-4" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-arduino codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">#define NUM_SENSORS 3</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zumo32U4LineSensors lineSensors;              // Liniensensor-Objekt</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">unsigned int lineSensorValues[NUM_SENSORS];   // Array für die Sensorwerte</span></div><div class="token-line" style="color:#393A34"><span class="token plain">lineSensors.readCalibrated(lineSensorValues); // Array für die Sensorwerte wird überschrieben</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="int-readline"></a><code>int readLine(...)</code><a class="hash-link" href="#int-readline" title="Direct link to heading">#</a></h3><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-arduino codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">int readLine(unsigned int *sensor_values, unsigned char readMode=QTR_EMITTERS_ON, unsigned char white_line=0)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Funktioniert wie <code>readCalibrated()</code>, gibt aber auch eine geschätzte Position des Roboters in Bezug auf eine Linie zurück. Die Schätzung erfolgt unter Verwendung eines <a href="https://de.wikipedia.org/wiki/Gewichtung" target="_blank" rel="noopener noreferrer">gewichteten Mittelwerts</a>, welcher die Sensorwerte mit Vielfachen von 1000 multipliziert, so dass ein Rückgabewert von 0 anzeigt, dass die Zeile direkt unter Sensor 0 liegt, ein Rückgabewert von 1000 zeigt an, dass die Zeile direkt unter Sensor 1 liegt, 2000 zeigt an, dass sie unter Sensor 2000 liegt, usw.  Zwischenwerte zeigen an, dass sich die Linie zwischen zwei Sensoren befindet. Die Formel lautet : $$ \frac{0\cdot x_0 + 1000\cdot x_1 + 2000 \cdot x_2 +\cdots}{x_0 + x_1 + x_2 + \cdots} $$ </p><p>Standardmäßig geht diese Funktion von einer dunklen Linie (hohe Werte) aus, die von Weiß (niedrige Werte) umgeben ist.  Wenn die verwendete Linie hell auf Schwarz ist, setzen Sie das optionale zweite Argument <code>white_line</code> auf <code>true</code>.  In diesem Fall wird jeder Sensorwert vor der Mittelung durch (1000 - Wert) ersetzt.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="beispiel-5"></a>Beispiel<a class="hash-link" href="#beispiel-5" title="Direct link to heading">#</a></h4><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-arduino codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">#define NUM_SENSORS 5</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zumo32U4LineSensors lineSensors;              // Liniensensor-Objekt</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">unsigned int lineSensorValues[NUM_SENSORS];   // Array für die Sensorwerte</span></div><div class="token-line" style="color:#393A34"><span class="token plain">int position = lineSensors.readLine(lineSensorValues);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="beispiel-für-die-bestimmung-der-linienposition"></a>Beispiel für die Bestimmung der Linienposition<a class="hash-link" href="#beispiel-für-die-bestimmung-der-linienposition" title="Direct link to heading">#</a></h2><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-arduino codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">/*</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   Liniensensor-Demo mit alle fünf Boden Sensoren</span></div><div class="token-line" style="color:#393A34"><span class="token plain">*/</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">#include &lt;Zumo32U4.h&gt;</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zumo32U4LineSensors lineSensors;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zumo32U4ButtonA buttonA;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zumo32U4Motors motors;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Zumo32U4LCD lcd;</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">#define NUM_SENSORS 5                       // Anzahl der verwendeten Sensoren</span></div><div class="token-line" style="color:#393A34"><span class="token plain">unsigned int lineSensorValues[NUM_SENSORS]; // Array für die Sensorwerte</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">int timeStamp = 0;</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">// Eine Sekunde warten und dann beginnen mit der Kalibirierung der Bodensensoren</span></div><div class="token-line" style="color:#393A34"><span class="token plain">// durch automatisches Drehen des Roboters um etwa -90, +180, -90 Grad.</span></div><div class="token-line" style="color:#393A34"><span class="token plain">void calibrateSensors()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  lcd.clear();</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  lcd.print(F(&quot;Calib ...&quot;));</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  delay(1000);</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  // Kalibirierungsschleife: Roboter dreht sich und nimmt 120 Messwerte auf</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  for (int i = 0; i &lt; 120; i++)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    if (i &gt; 30 &amp;&amp; i &lt;= 90){</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      motors.setSpeeds(-200, 200);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    else{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      motors.setSpeeds(200, -200);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    } </span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    lineSensors.calibrate();  // Sensoren auswerten und kalibrieren</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  motors.setSpeeds(0, 0);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  lcd.clear();</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">void setup() {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  lineSensors.initFiveSensors();    // Bodensensoren initialisieren</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  // &quot;Welcome&quot;-Anzeige auf dem Display</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  lcd.clear();</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  lcd.gotoXY(0, 0); lcd.print(F(&quot;LineDemo&quot;));</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  lcd.gotoXY(0, 1); lcd.print(F(&quot;-&gt; A&quot;));</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  buttonA.waitForPress();</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  lcd.clear();</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  calibrateSensors();</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">void loop() {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  </span></div><div class="token-line" style="color:#393A34"><span class="token plain">  int updateTime = 333;</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  // alle 0.33 ms auswerten der Sensoren und aktualisieren des Display</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  if ( (millis() - timeStamp) &gt; updateTime){</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    int position = lineSensors.readLine(lineSensorValues);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    lcd.gotoXY(0,0);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    lcd.print(position);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    lcd.print(F(&quot;   &quot;));  </span></div><div class="token-line" style="color:#393A34"><span class="token plain">  }</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://spacehal.github.io/docs/zumo32u4/lineSensor.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/zumo32u4/buttons"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Die Taster</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/zumo32u4/motors"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Die Motoren »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_ thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#einführung" class="table-of-contents__link">Einführung</a></li><li><a href="#konfigurieren" class="table-of-contents__link">Konfigurieren</a><ul><li><a href="#void-initthreesensors" class="table-of-contents__link"><code>void initThreeSensors()</code></a></li><li><a href="#void-initfivesensors" class="table-of-contents__link"><code>void initFiveSensors()</code></a></li><li><a href="#void-init" class="table-of-contents__link"><code>void init(...)</code></a></li><li><a href="#void-calibrate" class="table-of-contents__link"><code>void calibrate()</code></a></li></ul></li><li><a href="#messen" class="table-of-contents__link">Messen</a><ul><li><a href="#void-read" class="table-of-contents__link"><code>void read(...)</code></a></li><li><a href="#void-readcalibrated" class="table-of-contents__link"><code>void readCalibrated(...)</code></a></li><li><a href="#int-readline" class="table-of-contents__link"><code>int readLine(...)</code></a></li></ul></li><li><a href="#beispiel-für-die-bestimmung-der-linienposition" class="table-of-contents__link">Beispiel für die Bestimmung der Linienposition</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/SpaceHal/spacehal.github.io/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Schule</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.osztiem.de/" target="_blank" rel="noopener noreferrer" class="footer__link-item">OSZTIEM</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.arduino.cc/reference/de/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Arduino</a></li></ul></div></div><div class="text--center"><div>Copyright © 2021 Stefan Warm. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.62cc0809.js"></script>
<script src="/runtime~main.fe4ffd91.js"></script>
<script src="/main.3a113c97.js"></script>
<script src="/1.05c99323.js"></script>
<script src="/63.da0c22a9.js"></script>
<script src="/66.990c23fc.js"></script>
<script src="/935f2afb.1d471f00.js"></script>
<script src="/62.fbe59718.js"></script>
<script src="/d943a4ea.0c352c0f.js"></script>
</body>
</html>